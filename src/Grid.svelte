<script context="module">
  let totalItems = 0;
</script>

<script>
  import { MAX_WIDTH } from './constants';

  export let projects;
  export let columns = 2;

  let colorOffset = totalItems;
  totalItems += projects.length;

  const colors = [
    '#A32251',
    '#0041FF',
    '#1A1A57',
    '#D91F25',
    '#004F50',
    '#EBAB3D',
  ];

  const minFr = 600 - 100 * columns;

  let clientWidth, mediaHeight, gridColumns;
  $: {
    let fr = (clientWidth - 25 * (columns - 1)) / columns; // 1fr
    if (fr < minFr) {
      fr = clientWidth;
      gridColumns = '1fr';
    } else {
      gridColumns = '1fr '.repeat(columns);
    }
    mediaHeight = fr * (2 / 3);
  }

  const color = index => colors[(colorOffset + index) % colors.length];
</script>

<style lang="scss">
  .grid {
    display: grid;
    row-gap: 50px;
  }

  :global(.grid + .grid) {
    margin-top: 50px;
  }

  .media {
    width: 100%;
    margin-bottom: 14px;
    img,
    video {
      object-fit: cover;
      object-position: 50% top;
      width: 100%;
      height: 100%;
      border: 1px solid #000;
    }
  }

  :global(code) {
    font-family: Inconsolata;
  }

  .description {
    color: #888;
  }
</style>

<div
  class="grid"
  style="grid-template-columns: {gridColumns}; column-gap: {columns > 1 ? 25 : 0}px; {columns === 1 && 'text-align: center'}"
  bind:clientWidth
>
  {#each projects as { name, image, description, url }, index}
    <div >
      <a href={url} style="color: {color(index)}">
        <div class="media" style="height: {Math.round(mediaHeight)}px">
          {#if image.includes('.mp4')}
            <video autoPlay playsInline muted loop>
              <source src={image} />
            </video>
          {:else}
          <picture>
            {#if image.includes('.webp')}
              <source srcset="{image} 1x" type="image/webp">
            {/if}
            <img src={image.replace('.webp', '.png')} alt={name} />
          </picture>
          {/if}
        </div>
        <p>{@html name}</p>
      </a>
      {#if description}
        <p class="description">{description}</p>
      {/if}
    </div>
  {/each}
</div>
